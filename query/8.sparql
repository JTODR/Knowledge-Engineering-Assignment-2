PREFIX afn: <http://jena.hpl.hp.com/ARQ/function#>
PREFIX fn: <http://www.w3.org/2005/xpath-functions#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX par: <http://parliament.semwebcentral.org/parliament#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX time: <http://www.w3.org/2006/time#>
PREFIX xml: <http://www.w3.org/XML/1998/namespace>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

PREFIX osi: <http://ontologies.geohive.ie/osi#>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX geof: <http://www.opengis.net/def/function/geosparql/>
PREFIX sf: <http://www.opengis.net/ont/sf#>

PREFIX trail: <http://www.this.com/ontologies/irish-trails-ontology#>

# Rank trails within a district based on Estimated Completion Time and that allow dogs.
#   Parameters:
#   Returns:     district, trailName, startPoint, completionTime, dogsAllowed

SELECT ?districtName ?trailName, ?trailStartPoint, ?trailEstimatedCompletionTime, ?trailDogsAllowed
# ********************************************************
# Use of 'FROM' gives http 500 error, not sure why.
# I believe using 'GRAPH ?g' will search all graphs and union the results? I have not tested this
# ********************************************************
#FROM <file:///usr/local/ParliamentKB/geohive>
#FROM <file:///usr/local/ParliamentKB/irish_trails>

WHERE {
  GRAPH ?g {
     ?district a osi:Municipal_District.
     ?district rdfs:label ?districtName.
     ?district geo:hasGeometry ?geom.
     ?geom geo:asWKT ?wkt.

     ?trail trail:name ?trailName.
     ?trail trail:startPoint ?trailStartPoint.
     ?trail trail:dogsAllowed ?trailDogsAllowed.
     ?trail trail:estimatedCompletionTime ?trailEstimatedCompletionTime.
  }
} ORDER BY ASC(?trailEstimatedCompletionTime)
